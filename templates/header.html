{% load static %}
<header class="header">
  <div class="header-l">
    <a href="/" class="logo">
      <img
        src="{% static 'image\新增標題 (2).png' %}"
        class="logo-desktop"
        alt="FisshShop Desktop"
      />

      <img
        src="{% static 'image\未命名設計 (1).png' %}"
        class="logo-mobile"
        alt="FisshShop Mobile"
      />
    </a>
  </div>

  <div class="header-m">
    <ul>
      <li class="navber-list"><a href="/">首頁</a></li>
      <li class="navber-list"><a href="/">賣場</a></li>
      <li class="navber-list"><a href="{% url 'blog' %}">部落格</a></li>
      <li class="navber-list"><a href="/">控制台</a></li>
    </ul>
  </div>

  <div class="header-r">
    <div class="login-btn-case">
      <!-- 漢堡選單 傳   送訊號（權力轉移）靠的是 id 和 for 的綁定 class跟id一樣純屬好玩-->
      <input type="checkbox" id="menu-control" class="menu-control" />
      <label for="menu-control" class="hb-icon">
        <span></span>
        <span></span>
        <span></span>
      </label>
      <!-- 漢堡選單 -->
      <ul class="navber-list-case">
        <li class="navber-list"><a href="/">首頁</a></li>
        <li class="navber-list"><a href="/">賣場</a></li>
        <li class="navber-list"><a href="{% url 'blog' %}">部落格</a></li>
        <li class="navber-list"><a href="/">控制台</a></li>


        <li class="navber-list">
          {% if user.is_authenticated %}
          <a href="{% url 'account_logout' %}">登出</a>
          {% else %}
          <a href="{% url 'login' %}">登入</a>
          {% endif %}
        </li>
      </ul>

      {% if user.is_authenticated %}
      <div class="user-case">
        {% if user.socialaccount_set.all.0.get_avatar_url %}
        <img
          src="{{ user.socialaccount_set.all.0.get_avatar_url }}"
          alt="avatar"
          class="user-photo"
        />
        {% else %}
        <div class="user-photo">{{ user.username|slice:":1" }}</div>
        <!-- 切第一個字下來 -->
        {% endif %}

        <div class="dropdown-menu" id="dropdown-menu">
          <a href="{% url 'account_logout' %}" class="logout-btn">登出</a>
        </div>
      </div>
      {% else %}
      <a href="{% url 'login' %}" class="login-btn">登入</a>
      {% endif %}
    </div>
  </div>

  <script>
    // 使用 DOMContentLoaded 確保 Header 載入後才執行 JS
    document.addEventListener("DOMContentLoaded", () => {
      const userTrigger = document.querySelector(".user-case");
      const dropdownMenu = document.querySelector(".dropdown-menu");

      // 只有在「已登入」且元素存在時才執行，避免在未登入頁面噴錯
      if (userTrigger && dropdownMenu) {
        // 點擊頭像區塊：切換選單
        userTrigger.addEventListener("click", (event) => {
          event.stopPropagation(); // 防止事件傳到 window 導致選單秒關
          dropdownMenu.classList.toggle("show");
        });

        // 點擊網頁任何地方：關閉選單
        window.addEventListener("click", () => {
          if (dropdownMenu.classList.contains("show")) {
            dropdownMenu.classList.remove("show");
          }
        });
      }
    });
  </script>
</header>
